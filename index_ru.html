<html>

<head>
    <link rel="stylesheet" type="text/css" href="main.css">
    <title>Математика и статистика в выборе чемпионов в League of Legends ARAM</title>
</head>

<body>
<div class="main_container">
    <h2> Математика и статистика в выборе чемпионов в League of Legends ARAM </h2>
    <div class="localization_link_container"><a href="index.html">[EN] Switch to English</a></div>


    <h3 id="general_information_title" class="expandable">Общая информация про LoL ARAM <span class="title_hint" id="general_information_hint">[нажмите чтобы развернуть]</span></h3> 

    <div id="general_information_container" style="display: none;">
        <p>
            <a href="https://leagueoflegends.fandom.com/wiki/ARAM">ARAM (или All Random All Mid)</a> &mdash; это игровой режим 
            в League of Legends в формате 5-на-5 на карте Воющая Бездна (Howling Abyss).
            Две команды по пять игроков в каждой играют друг против друга.
            В этой игре каждый игрок управляет одним чемпионом, который выбирается в лобби игры до того как игра начнется.
            В этом режиме игроки получают случайных чемпионов из списка доступных чемпионов, могут обмениваться чемпионами и рероллить чемпионов.
        </p>

        <p>
            Когда лобби ARAM'а начинается каждый игрок роллит одного чемпиона. Этот чемпион выбирается случайно из доступных игроку чемпионов.
            Роллы игроков выполняются последовательно.
            Команды не видят пики оппонентов.
            Каждый чемпион в игре может быть зароллен или зарероллен в лобби не более одного раза (на обе команды).
        </p>
        <p>
            Каждый игрок может накопить максимум два реролла.
            Игрок может применить реролл и заменить своего чемпиона (зарероллить).
            При этом он получает нового чемпиона, а предыдущий чемпион помещается в список открытых для команды.
            У каждой команды свой список открытых чемпионов.
            Любой игрок может поменять своего чемпиона на любого из списка открытых для его команды,
            если этот чемпион куплен у этого игрока или этот чемпион входит в список доступных всем.
        </p>

        <p>
            Каждый реролл стоит 250 очков реролла (максимум 500 очков реролла).
            Очки реролла начисляются каждому игроку после каждой игры.
            Точное количество зависит от количества купленных чемпионов (формула: 65 + 1.5 x доступных чемпионов).
            Неиспользованные очки реролла сохраняются и переносятся в следующее лобби ARAM'а.
        </p>
    </div>

    <h3 id="article_purpose_title">Цель</h3> 

    <p>
        У многих игроков есть сомнения в распределении чемпионов в ARAM'е.
        Кажется что чемпионы повторяются слишком часто, вам не выпадают ваши любимые чемпионы.
        Однако весь процесс немного сложнее, чем может интуитивно показаться.
        Существует несколько когнитивных искажений, которые могут сильно повлиять на ожидания:
    </p>
    
    <p>
        <span class="h_marker">Конкретный чемпион.</span> Когда вам выпадает Катарина 3 раза подряд, то вы можете подумать, 
            что это весьма маловероятное событие.
            Однако ваши ощущения не сильно изменятся, если вы получите Шако, Варуса или Кай'Су 3 раза подряд.
            Получение конкретного чемпиона (например конкретно Катарину) отличается от получения одного и того же чемпиона. Последнее намного более вероятно.
    </p>

    <p>
        <span class="h_marker">Парадокс дней рождения.</span> Скажем в игре есть всего 161 чемпион. Также есть 10 чемпионов, на которых вам нравится играть.
            Лобби игры начинается и ваша команда роллит 10 чемпионов, из которых можно выбрать чемпиона на игру.
            Насколько вероятно что среди этих чемпионов будет хотябы один, на котором вам нравится играть? Это примерно 48%.
            Это схоже с <a href="https://ru.wikipedia.org/wiki/%D0%9F%D0%B0%D1%80%D0%B0%D0%B4%D0%BE%D0%BA%D1%81_%D0%B4%D0%BD%D0%B5%D0%B9_%D1%80%D0%BE%D0%B6%D0%B4%D0%B5%D0%BD%D0%B8%D1%8F" target="_blank">парадоксом дней рождения</a>.
    </p>

    <p>
        <span class="h_marker">Множество игр.</span>
        Люди склонны уделять больше внимания конкретным событиям нежели всему процессу целиком.
        Вероятность сыграть всего 3 игры и в каждой получить Катарину намного меньше, 
        чем сыграть 30 игр и один раз получить Катарину 3 раза подряд за эту серию игр.
    </p>

    <p>
        Эта статья посвящена построению математической модели для оценки вероятности определенных событий, основываясь при этом на равной вероятности для всех чемпионов.
    </p>

    <h3 id="approach_details_title" class="expandable">Подход и детали модели <span class="title_hint" id="approach_details_hint">[нажмите чтобы развернуть]</span></h3> 

    <div id="approach_details_container" style="display: none;">
        
        <p>
            Некоторые предположения этой модели в порядке важности:
        </p>

        <ol>
            <li>
                Прежде всего, эта модель предполагает, что все доступные чемпионы имеют
                <span class="h_marker">равную вероятность</span> выпасть при каждом ролле или реролле.
            </li>

            <li>
                Все игроки имеют один и тот же фиксированный набор (или подмножество) доступных чемпионов.
                Это позволяет сделать всех чемпионов взаимозаменяемыми и опустить всевозможные аспекты популярности чемпионов,
                доступности чемпионов, порядка роллов и рероллов.
                Количество доступных чемпионов &mdash; это один из параметров модели.
            </li>

            <li>
                В реальной игре игроки предпочитают брать своих любимых или сильных чемпионов. Это тяжело формализовать.
                В этом модели игроки будут пытаться максимизировать условие:
                все игроки будут пытаться брать чемпиона с наибольшим количеством игр или с наибольшим количеством игр подряд (в текущий момент).
                Вероятно, это не то как игроки поступают в целом, однако это определенно валидная формальная стратегия.
                Также наиболее популярные чемпионы в общем являются наиболее сильными и наиболее предпочитаемыми.
                Поэтому можно сказать, что игроки предпочитают брать <span class="h_marker">одних и тех же</span> сильных 
                и <span class="h_marker">одних и тех же</span> любимых чемпионов.
                В первой игре в симуляции у игроков не будет предпочтений.
            </li>

            <li>
                Игроки не будут сохранять рероллы для будущих игр. Все доступные рероллы будут тратиться каждую игру.
                Всех игроки получают одинаковое количество очков реролла за игру 
                (потому что они все имеют одинаковое количество доступных чемпионов).
                Количество рероллов за игру &mdash; это один из параметров модели.
            </li>

            <li>
                Количество рероллов за игру может иметь дробное значение. В таком случае игроки будут будут использовать целое количество рероллов,
                а оставшиеся очки реролла будут перенесены на следующую игру.
                Если в вычислениях задействовано более одного игрока (команда из 5 игроков),
                то количество рероллов будет высчитываться как сумма рероллов всех включенных игроков.
                Можно думать об этом как о размере списка открытых чемпионов для команды.
                Эта сумма рероллов округляется вниз до ближайшего целого числа, а оставшаяся часть переносится на следующие игры.
                Например, с 1.5 рероллов за игру общее количество рероллов на команду из 5 человек
                будет чередоваться между 7 и 8 рероллами каждые 2 игры.
            </li>

            <li>
                Игроки не будут доджить игры (отменять старт игры с помощью выхода из лобби).
                Теоретически додж игр может быть использован как безграничный источник улучшения чемпионов вашей команды.
                Реальные игроки могут иногда использовать его для того, что отменить какие-нибудь неудачные сетапы.
            </li>

            <li>
                Игроки не будут мешать друг другу и будут всегда свободно обмениваться чемпионами.
            </li>

        </ol>

        <p>
            Эта модель вычисляет вероятность "повысить" чемпионов за серию игр,
            где каждая игра выдает набор случайных чемпионов для выбора (draft pool) и подмножество этих чемпионов выбирается в список для повышения (upgrade pool).
            Повышение чемпиона может иметь разные значения, самый простой пример &mdash; это сыграть игру с этим чемпионом.
            Количество чемпионов для выбора и чемпионов для повышения может варьироваться.
            Повышения могут сохраняться на протяжении всего вычисления (сыграть X раз всего)
            или могут сбрасываться после каждой игры без повышения (сыграть X раз подряд).
        </p>

        <p>
            Список параметров модели:
        </p>

        <ol>
            <li>
                total_games &mdash; общая длина последовательности игр, которую нужно вычислить;
            </li>
            
            <li>
                total_champions &mdash; общее количество чемпионов, которые могут быть получены;
            </li>
            
            <li>
                target_streak &mdash; маскимальное количество повышений, которое нужно применить к одному чемпиону для того чтобы посчитать условие выполненным;
            </li>

            <li>
                draft_pool &mdash; размер draft pool &mdash; количество случайно выбираемых чемпионов, которые могут быть повышены;
            </li>

            <li>
                upgrade_pool &mdash; размер upgrade pool &mdash; размер подмножества выпавших в draft чемпионов, которые непосредственно получат повышение;
            </li>

            <li>
                reset_on_failure &mdash; если установлено в true, то количество повышений на чемпионе будет сброшено в ноль после игры без повышения, 
                иначе количество повышений сохраняется на протяжении всех игр.
            </li>
        </ol>

        <p>
            Нам нужно посчитать вероятности для серии событий, где текущие решения основываются на предыдущих.
            Динамическое программирование &mdash; это самый прямолинейный способ сделать это.
            Модель будет обрабатывать игры в последовательности друг за другом, поддерживая при этом 
            все возможные ситуации (состояния), которые могут быть достигнуты после текущей игры.
        </p>

        <p>
            Состояния собраны вместе в слои по количеству сыгранных игр.
            Количество игр можно считать неявным аргументом состояния.
            Модель хранит только два слоя: слой текущей игры и слой следующей игры.
        </p>

        <p>
            Конечно хранить информацию о каждом чемпионе слишком расточительно.
            Вместо этого чемпионы собраны в группы по количеству полученных повышений и размеры каждой группы сохранены в виде вектора.
            Этот вектор является аргументом в динамическом программировании.
            Значение для каждого состояния динамического программирования &mdash; это вероятность попасть в это состояние.
        </p>

        <p>
            Переходы динамического программирования &mdash; это добавление еще одной игры из текущего состояния.
            Это выполняется рекурсивно.
            На каждом шаге рекурсии одна рассматривается одна группа чемпионов, начиная с наибольшего количества повышений.
            Рассматриваются все возможные способы получить чемпионов этой группы в лобби (все возможные их количества).
            Для всех последующих шагов эта группа чемпионов исключается из рассмотрения (чемпионы и попавшие в лобби, и не попавшие).
            Когда все группы чемпионов будут рассмотрены состояние, в которое будет сделан переход, будет достроено.
            Переход завершен и вероятность добавляется в состояние на следующем слое.
        </p>

        <p>
            Количество состояний и переходов все еще экспоненциально,
            но рост ограничивается несколькими параметрами и оптимизациями.
            Когда состояние получает требуемое количество повышений хотябы на одном чемпионе, 
            то эта вероятность добавляется к результату и такое состояние дальше не расширяется.
            Когда состояние или ветка перехода имеют вероятность близкую к нулю, то они сразу останавливаются и дальше не расширяются.
        </p>

        <p>
            Переходы вычисляются независимо для каждого состояния.
        </p>

        <p>
            <a href="https://ru.wikipedia.org/wiki/%D0%93%D0%B8%D0%BF%D0%B5%D1%80%D0%B3%D0%B5%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B5_%D1%80%D0%B0%D1%81%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5">Гипергеометрическое распределение</a> 
            используется для вычисления разделения вероятности на каждом шаге переходов.
            На этой стадии все чемпионы деляться на чемпионов текущей группы и всех остальных чемпионов.
            Для заданного количества чемпионов и размера текущей группы нужно посчитать вероятность,
            что в равновероятно выбранном подмножестве из draft_pool чемпионов будет ровно X чемпионов из текущей группы.
            Гипергеометрическое распределение используется на каждом шаге рекурсии и коэффициенты перемножаются для каждой группы в состоянии.
        </p>

        <p>
            Эта модель соответствует механике выбора персонажей в ARAM из патча LoL 12.17.1.
        </p>

        <p>
            Этот документ последний раз обновлялся 19 сентября 2022.
        </p>

    </div>

    <span id="s_comp_complete" class="localization_string">Вычисления завершены для AAA чемпионов, BBB рероллов за игру (CCC мс, DDD состояний в пике, EEE переходов)</span>
    <span id="s_comp_complete_b" class="localization_string">Вычисления завершены для AAA чемпионов (BBB мс)</span>
    <span id="s_comp_in_progress" class="localization_string">Вычисления в процессе...</span>
    <span id="s_x_in_a_row" class="localization_string">AAA подряд</span>
    <span id="s_x_in_total" class="localization_string">в AAA играх</span>
    <span id="s_x_games_played" class="localization_string">AAA игр сыграно</span>
    <span id="s_x_champions" class="localization_string">AAA чемпионов</span>
    <span id="s_x_in_lobby_rerolls" class="localization_string">AAA в лобби (BBB рероллов)</span>
    <span id="s_x" class="localization_string">AAA</span>

    <h3>Параметры</h3>

    <p>
        Используйте форму ниже для изменения глобальных параметров всех вычислений.
    </p>

    <p>
        Количество чемпионов не обязательно должно быть равно количество чемпионов в игре.
        Оно может быть уменьшено вплоть до 65 для получения более актуальной информации о низкоуровневых или специальных аккаунтах.
        Количество рероллов привязано к количеству чемпионов формулой: 65 + 1.5 x доступных чемпионов.
        Но оно также может быть изменено независимо для получения более актуальной информации о коротких сериях игр со специальными условиями.
    </p>

    <p>
        Наиболее обоснованные сценарии для вычислений:
    </p>

    <ol>
        <li>161 чемпионов / 1.224 рероллов за игру &mdash; все чемпионы</li>
        <li>124 чемпионов / 1 рероллов за игру &mdash; ровно один реролл за игру</li>
        <li>100 чемпионов / 0.86 рероллов за игру &mdash; средние аккаунты</li>
        <li>75 чемпионов / 0.71 рероллов за игру &mdash; новые аккаунты</li>
    </ol>

    <p>
        Количество чемпионов должно быть целым числом в диапазоне [65; 300]. Количество рероллов должно быть вещественным числом в диапазоне [0; 2].
        Ввод любых других значений может привести к ошибкам или к очень долгим и требовательным к памяти вычислениям.
        Если что-то пойдет не так, просто перезагрузите страницу.
    </p>

    <p>
        <span id="control_form_status_label" class="model_status_label">Инициализация скриптов...</span>
        <br>
        Количество чемпионов: <input id="input_champions_total" value='161' type="text" size="5">
        <br>
        Количество рероллов за игру: <input id="input_rerolls_per_game" value='1.224' type="text" size="5">
        <br>
        <button id="recalculate_button" class="recalculate_button" disabled>Пересчитать</button>
    </p>

    <h3>Результаты</h3> 

    <p>Наведите курсор на ячейки таблицы для получения точных подсказок.</p>

    <span id="s_title_b1" class="localization_string">AAA шанс получить хотя бы одного из BBB любимых чемпионов среди CCC чемпионов в лобби</span>

    <p><span class="s_marker">[B-1]</span>
        Вероятность получить хотя бы одного из 
        <span class="h_marker">Y</span> любимых чемпионов 
        среди <span class="h_marker">X</span> чемпионов в лобби
    </p>

    <p>Это вычисляется более простой формулой С(N - A, B) / C(N, B) без использования основной модели.</p>

    <div class="table_container" id="table_favorite_champions">
        <span class="model_status_label">Инициализация скриптов...</span>
        <table>
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>

    <span id="s_title_c1" class="localization_string">AAA шанс сыграть против одного и того же чемпиона BBB игр подряд за серию из CCC игр (как минимум один раз)</span>

    <p><span class="s_marker">[C-1]</span>
        Вероятность сыграть против <span class="h_marker">одного и того же</span> 
        чемпиона <span class="h_marker">Y</span> игр <span class="h_marker">подряд</span> 
        за серию из <span class="h_marker">X</span> игр (как минимум один раз):
    </p>

    <div class="table_container" id="table_play_against_row">
        <span class="model_status_label">Инициализация скриптов...</span>
        <table>
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>

    <span id="s_title_c2" class="localization_string">AAA шанс сыграть против одного и того же чемпиона как минимум в BBB играх за серию из CCC игр</span>

    <p><span class="s_marker">[C-2]</span>
        Вероятность сыграть против <span class="h_marker">одного и того же</span> 
        чемпиона как минимум в <span class="h_marker">Y</span> играх 
        за серию из <span class="h_marker">X</span> игр:
    </p>

    <div class="table_container" id="table_play_against_sum">
        <span class="model_status_label">Инициализация скриптов...</span>
        <table>
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>

    <span id="s_title_c3" class="localization_string">AAA шанс сыграть за одного и того же чемпиона BBB игр подряд за серию из CCC игр (как минимум один раз)</span>

    <p><span class="s_marker">[C-3]</span>
        Вероятность сыграть за <span class="h_marker">одного и того же</span> 
        чемпиона <span class="h_marker">Y</span> игр <span class="h_marker">подряд</span> 
        за серию из <span class="h_marker">X</span> игр (как минимум один раз):
    </p>

    <div class="table_container" id="table_play_as_row">
        <span class="model_status_label">Инициализация скриптов...</span>
        <table>
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>

    <span id="s_title_c4" class="localization_string">AAA шанс сыграть за одного и того же чемпиона как минимум в BBB играх за серию из CCC игр</span>

    <p><span class="s_marker">[C-4]</span>
        Вероятность сыграть за <span class="h_marker">одного и того же</span> 
        чемпиона как минимум в <span class="h_marker">Y</span> играх 
        за серию из <span class="h_marker">X</span> игр:
    </p>

    <div class="table_container" id="table_play_as_sum">
        <span class="model_status_label">Инициализация скриптов...</span>
        <table>
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>

    <span id="s_title_c5" class="localization_string">AAA шанс самому зароллить/зарероллить одного и того же чемпиона BBB игр подряд за серию из CCC игр (как минимум один раз)</span>

    <p><span class="s_marker">[C-5]</span>
        Вероятность самому зароллить/зарероллить <span class="h_marker">одного и того же</span> 
        чемпиона <span class="h_marker">Y</span> игр <span class="h_marker">подряд</span> 
        за серию из <span class="h_marker">X</span> игр (как минимум один раз):
    </p>

    <p>Это вычисляется для одного игрока.</p>

    <div class="table_container" id="table_roll_row">
        <span class="model_status_label">Инициализация скриптов...</span>
        <table>
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>

    <span id="s_title_c6" class="localization_string">AAA шанс самому зароллить/зарероллить одного и того же чемпиона как минимум в BBB играх за серию из CCC игр</span>

    <p><span class="s_marker">[C-6]</span>
        Вероятность самому зароллить/зарероллить <span class="h_marker">одного и того же</span> 
        чемпиона как минимум в <span class="h_marker">Y</span> играх 
        за серию из <span class="h_marker">X</span> игр:
    </p>

    
    <p>Это вычисляется для одного игрока.</p>

    <div class="table_container" id="table_roll_sum">
        <span class="model_status_label">Инициализация скриптов...</span>
        <table>
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>

    <span id="s_title_c7" class="localization_string">AAA шанс самому зароллить/зарероллить и сыграть за одного и того же чемпиона BBB игр подряд за серию из CCC игр (как минимум один раз)</span>

    <p><span class="s_marker">[C-7]</span>
        Вероятность самому зароллить/зарероллить и сыграть за <span class="h_marker">одного и того же</span> 
        чемпиона <span class="h_marker">Y</span> игр <span class="h_marker">подряд</span> 
        за серию из <span class="h_marker">X</span> игр (как минимум один раз):
    </p>

    <p>Это вычисляется для одного игрока.</p>

    <div class="table_container" id="table_roll_and_play_row">
        <span class="model_status_label">Инициализация скриптов...</span>
        <table>
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>

    <span id="s_title_c8" class="localization_string">AAA шанс самому зароллить/зарероллить и сыграть за одного и того же чемпиона как минимум в BBB играх за серию из CCC игр</span>

    <p><span class="s_marker">[C-8]</span>
        Вероятность самому зароллить/зарероллить и сыграть за <span class="h_marker">одного и того же</span> 
        чемпиона как минимум в <span class="h_marker">Y</span> играх 
        за серию из <span class="h_marker">X</span> игр:
    </p>

    <p>Это вычисляется для одного игрока.</p>

    <div class="table_container" id="table_roll_and_play_sum">
        <span class="model_status_label">Инициализация скриптов...</span>
        <table>
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>

    <span id="s_title_c9" class="localization_string">AAA шанс просто получить и сыграть за одного и того же чемпиона BBB игр подряд за серию из CCC игр (как минимум один раз)</span>

    <p><span class="s_marker">[C-9]</span>
        Вероятность просто получить и сыграть за <span class="h_marker">одного и того же</span> 
        чемпиона <span class="h_marker">Y</span> игр <span class="h_marker">подряд</span> 
        за серию из <span class="h_marker">X</span> игр (как минимум один раз):
    </p>

    <p>
        Это вычисляется для одного игрока. Рероллы и обмены персонажами тут не учитываются.
    </p>

    <div class="table_container" id="table_pure_random_row">
        <span class="model_status_label">Инициализация скриптов...</span>
        <table>
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>

    <span id="s_title_c10" class="localization_string">AAA шанс просто получить и сыграть за одного и того же чемпиона как минимум в BBB играх за серию из CCC игр</span>

    <p><span class="s_marker">[C-10]</span>
        Вероятность просто получить и сыграть за <span class="h_marker">одного и того же</span> 
        чемпиона как минимум в <span class="h_marker">Y</span> играх 
        за серию из <span class="h_marker">X</span> игр:
    </p>

    <p>
        Это вычисляется для одного игрока. Рероллы и обмены персонажами тут не учитываются.
    </p>

    <div class="table_container" id="table_pure_random_sum">
        <span class="model_status_label">Инициализация скриптов...</span>
        <table>
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>

</div>

<script type="text/javascript" src="main.js"></script>

</body>

</html>
